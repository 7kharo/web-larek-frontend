# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы используемые в приложении

Интерфейс даных приходящих с сервера:

```
interface ApiResponse {
    total: number;
    items: IProduct[],
}
```

Интерфейс товара:

```
interface IProduct {
    id: string;
    title: string;
    description: string;
    category: ProductType;
    price: number | null;
    image: string;
}
```

Интерфейс данных, вводимых в форме:
```
interface IForm {
    payment: PaymentType;
    address: string;
    email: string;
    phone: string;
}
```

Интерфейс данных для сформированного заказа:

```
interface IOrder extends IForm {
    items: string[]
    total: number;
}
```

Интерфейс для списка товаров на главной странице:
```
interface IProductList {
    items: IProduct[];
}
```

Интерфейс для списка товаров в корзине:
```
interface IBasket {
    productsBasket: IProduct[];
}
```
Интерфейс для полученного с сервера результата после успешного заказа

```
interface IOrderResult {
    id: string;
    total: number;
}
```

Типы данных для полей внутри классов
```
type ProductType = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил';

type PaymentType = 'онлайн' | 'при получении' | '';

type FormErrors = Partial<Record<keyof IForm, string>>;
type CategoryClassesType = {
  [Key in ProductType]: string;
};
```


## Архитектура приложения 

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображенияе данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

### Базовый код

#### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET-запрос на переданный в параметрах endpoint и возвращает promise с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на endpoint переданный, как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - внутренний метод обработки ответов сервера, который проверяет статус ответа. При успешном ответе (`response.ok`) возвращает распарсенный JSON. В случае ошибки пытается извлечь сообщение об ошибке из тела ответа (`data.error`), а если не удалось, то использует стандартный `statusText`. Затем возвращает отклоненный Promise с ошибкой

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом IEvents:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс FormData
Класс отвечает за хранение и логику работы с данными, которые пользователь вводит через форму.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- protected formFields: IForm - объект содержащий поля формы (способ оплаты, адрес, email и номер телефона)
- protected events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных

Также класс предоставляет набор методов для взаимодействия с этими данными:

- getFormFields(): IForm - возвращает объект со всеми данными формы
- validateOrder(): FormErrors - возвращает объект со списком ошибок формы
- setFormField<T extends keyof IForm>(field: T, value: IForm[T]): void - устанавливает указанное поле формы
- clearForm (): void - очищает данные формы

#### Класс ProductList
Класс отвечает за хранение и логику работы с данными продаваемых продуктов.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- protected items: IProduct[] - список товаров главной страницы
- protected events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных


Также класс предоставляет набор методов для взаимодействия с этими данными:

- методы для сохранения и получения данных из полей класса:

- setProducts (productsArray: IProduct[]): void - метод сохраняющий в поле items массив товаров
- getProducts ():IProduct[] - метод возвращающий массив товаров из поля items
- getProductById (id:string):IProduct - метод возвращающий один товар по указанному id

#### Класс Basket
Класс отвечает за хранение и логику работы с данными продаваемых продуктов.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- protected products: IProduct[] - список товаров корзины
- protected events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных

Также класс предоставляет набор методов для взаимодействия с этими данными:

- isProductIn(productId: string): boolean - метод, проверяющий наличие товара в корзине по его Id
- getBasketProducts():IProduct[] - метод, возвращающий массив товаров в корзине
- getTotalSum(): number - метод, осуществляющий подсчет общей суммы товаров в корзине
- getItemsCount(): number - метод, осуществляющий подсчет количества товаров в корзине
- isBasketEmpty(): boolean - метод, проверяющий наличие товаров в корзине
- addProduct(product: IProduct): void - добавляется продукт в корзину (в конец массива _productsBasket)
- deleteProduct(productId: string):void - удаляется товар из массива по указанному в аргументе id
- clearBasket():void - очищает содержимое корзины (массива _productsBasket)

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных

#### Класс Component
Абстрактный базовый класс для создания UI-компонентов (таких как модальные окна).

- protected constructor(protected readonly container: HTMLElement). Конструктор принимает корневой DOM-элемент в который рендерится компонент. Код в конструкторе выполняется до инициализации дочернего класса.

#### Класс Page
Реализует главную страницу с товарами. Наследуется логика от класса `Component`.
- constructor(container: HTMLElement, protected events: IEvents). Конструктор принимает корневой DOM-элемент модального окна для его инициализации и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса:
- protected counter: HTMLElement - счетчик элементов в корзине
- protected catalog: HTMLElement - контейнер каталога товаров
- protected wrapper: HTMLElement - основная обертка страницы
- protected basket: HTMLElement - иконка корзины
- protected events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных

Методы класса:
- setCounter(value: number): void - метод для установки значения количества товаров в корзине в счетчик на странице
- setCatalog(cards: HTMLElement []): void - метод для добавления списка карточек на главную страницу
- setLocked(locked: boolean):void - метод для блокировки страницы (при открытии модального окна)

#### Класс Card
Класс для отображения карточки. Наследуется логика от класса `Component<ICard>`.

- constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions) - Конструктор принимает название корневого DOM-элемента карточки и контейнер с ее наполнением для ее инициализации, а также коллбэк для обработки клика по ней.

Поля класса:
- protected title: HTMLElement - название карточки
- protected cathegory: HTMLElement - категория карточки
- protected image?: HTMLImageElement - изображение карточки
- protected description?: HTMLElement - описание карточки
- protected button?: HTMLButtonElement - кнопка покупки товара с карточки
- protected price: HTMLElement - цена товара
Методы класса:

- renderCard (item: IProduct): HTMLElement - метод для создания разметки карточки по указанным данным (включает в себя защищенные методы по установки всех полей карточки: setId, setTitle, setDescription, setImage, setPrice и setCategory)
- toggleButtonText (value:boolean): void - метод для изменения текста кнопки добавления товара в корзину

#### Класс FormView
Общий класс для создания форм. Наследуется логика от класса `Component<IFormState>` с интерфейсом IFormState (с полями valid и errors за отображение результатов валидации формы).

Поля класса:
- protected submit: HTMLButtonElement - кнопка сабмита формы
- protected _errors: HTMLElement - поле ошибок формы

- constructor(protected container: HTMLFormElement, protected events: IEvents). Конструктор принимает корневой DOM-элемент формы для его инициализации, экземпляр класса `EventEmitter` для возможности инициализации событий и наполнение формы.

Методы класса:
- сеттеры для valid и errors
- render(): void - рендер формы для отображения на странице

#### Класс PaymentForm
Класс для создания формы оплаты. Наследуется логика от класса `FormView<IPaymentForm>` с интерфейсом IPaymentForm (с полями address: string и payment: PaymentType за отображение данных в форме с выбором вида платежа).

- constructor(container: HTMLFormElement, protected events: IEvents) - Конструктор принимает корневой DOM-элемент формы для его инициализации, экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса:
- protected online: HTMLButtonElement - кнопка "Онлайн"
- protected offline: HTMLButtonElement - кнопка "При получении"
- protected address: HTMLInputElement - поле ввода адреса


#### Класс ContactsForm
Класс для создания формы ввода контактов. Наследуется логика от класса `FormView<IContactsForm>` с интерфейсом IContactsForm (с полями phone: string и email: string за отображение данных в форме с вводом контактов).

- constructor(container: HTMLFormElement, protected events: IEvents) - Конструктор принимает корневой DOM-элемент формы для его инициализации, экземпляр класса `EventEmitter` для возможности инициализации событий.


#### Класс Modal
Реализует универсальное модальное окно. Наследуется логика от класса `Component`. Также предоставляет методы `open`, `close` и `render` для управления отображением модального окна. Устанавливает слушатели, на клавиатуру для закрытия модального окна по Esc, на клик в оверлэй и кнопку-крестик для закрытия попапа.

- constructor(container: HTMLElement, protected events: IEvents). Конструктор принимает корневой DOM-элемент модального окна для его инициализации и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса:
- _content: HTMLElement - наполнение модального окна
- protected closeButton: HTMLButtonElement - кнопка закрытия модального окна

#### Класс Success
Реализует модальное окно после успешной покупки. Наследуется логика от класса `Component`

- constructor(container: HTMLElement, actions?: ISuccessActions). Конструктор принимает корневой DOM-элемент модального окна для его инициализации и функцию коллбэк

Поля класса:
- protected button: HTMLButtonElement - кнопка "Продолжение покупок"
- protected description: HTMLElement - текстовое поле с описанием произведенного заказа

Методы:
- setDescription(value: number): void - метод, позволяющий установить текст описания в поле текстовое поле description

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаиподействие представления и данных между собой находится в файле `index.ts`, выполняющим роль презентера.\
Взаимодействие осуществляется за счет событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделей данных):*
- `productsList: changed` - инициализация и отрисовка списка товаров на главной странице

*События, возникающие при взаимодействии пользователя с интерфейсом: (генерируются классами, отвечающими за представление)*

- `product: preview` - при клике на карточку товара, вызывается модальное окно с полным описанием товара
- `product: addToBasket` - при добавлении в корзину по клику на кнопке "В корзину" в модальном окне с полным описанием товара
- `product: deleteFromBasket` -  при удалении товара из корзины на превью карточки
- `basket: render` - при необходимости отрисовки элементов корзины в модальном окне
- `basket: open` - при клике на иконку корзины открывается модальное окно с товарами в корзине
- `basket: order` - при клике на кнопку "Оформить" в модальном окне корзины открывается модальное окно для заполнения адреса и способа оплаты
- `basket: delete` - при клике на кнопку удаления товара в модальном окне корзины. При действии товар удаляется из массива productBasket, обновлчется счетчик корзины на главной странице
- `/^order\..*: change/` - при изменении полей формы в модальном окне с выбором оплаты
- `/^contacts\..*: change/` - при изменении полей формы в модальном окне с контактными данными
- `form: changed` - при изменении данных формы
- `order: submit` - при клике на кнопку "Далее" в модальном окне заполнения адреса и способа оплаты
- `contacts: submit` - при клике на кнопку "Оплатить" в модальном окне заполнения контактов
- `order: success` - при успешном ответе сервера после оплаты товара, открывается модальное окно об успешной оплате
- `modal: close` - при клике закрытия модального окна