# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы используемые в приложении

Товары:

```
interface IProduct {
    id: string;
    title: string;
    description: string;
    category: ProductType;
    price: number;
    image: string;
}
```

Форма:
```
interface IForm {
    payment: PaymentType;
    address: string;
    email: string;
    tel: string;
    clearForm(): void;
}
```

Интерфейс для модели даных товаров:
```
interface IProductList {
    products: IProduct[];
}
```

Интерфейс для модели данных товаров в корзине:
```
interface IBasket {
    productsBasket: TProductBasket[];
    addProduct(product: TProductBasket): void;
    deleteProduct(productId: string): void;
    clearBasket(): void;
}
```

Данные товаров, выводимых на главной странице:

```
type TProductMain = Pick<IProduct, 'id' | 'title' | 'image' | 'category' | 'price'>;
```

Данные товаров, помещенных в корзину:
```
type TProductBasket = Pick<IProduct, 'id' | 'title' | 'price'>;
```

Данные покупателя в форме выбора метода оплаты:
```
type TFormPayment = Pick<IForm, 'address' | 'payment'>;
```

Данные покупателя в форме для контактов покупателя:
```
type TFormContacts = Pick<IForm, 'email' | 'tel'>;
```

## Архитектура приложения 

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за отображенияе данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных

### Базовый код

#### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET-запрос на переданный в параметрах endpoint и возвращает promise с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на endpoint переданный, как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - внутренний метод обработки ответов сервера, который проверяет статус ответа. При успешном ответе (`response.ok`) возвращает распарсенный JSON. В случае ошибки пытается извлечь сообщение об ошибке из тела ответа (`data.error`), а если не удалось, то использует стандартный `statusText`. Затем возвращает отклоненный Promise с ошибкой



#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом IEvents:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс FormData
Класс отвечает за хранение и логику работы с данными, которые пользователь вводит через форму.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- payment: PaymentType - выбор типа оплаты в форме, при заказе товара
- address: string - адрес покупателя
- email: string - электронная почта покупателя
- tel: string - номер телефона покупателя
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных

Также класс предоставляет набор методов для взаимодействия с этими данными:

- getFormData(): IForm - возвращает объект со всеми данными формы
- checkValidation(field?: keyof IForm): boolean - универсальный метод валидации,возвращающий `true`, если данные валидны (`field` указзывается для валидации определнного поля ввода)
- setPayment(value: PaymentType): void - устанавливает способ оплаты
- setAddress(value: string): void - устанавливает адрес доставки
- setEmail(value: string): void - устанавливает адрес электронной почты пользователя
- setPhone(value: string): void - устанавливает номер телефона пользователя
- submit(): Promise<void> - отправляет данные формы на сервер
- clearForm(): void - метод отвечаюющий за очистку формы

#### Класс ProductList
Класс отвечает за хранение и логику работы с данными продаваемых продуктов.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _products: TProductMain[] - список товаров главной страницы
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных


Также класс предоставляет набор методов для взаимодействия с этими данными:

- методы для сохранения и получения данных из полей класса (такие как `loadProducts`, `addProduct`, `deleteProduct`, `updateProduct`)

#### Класс Basket
Класс отвечает за хранение и логику работы с данными продаваемых продуктов.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _productsBasket: TProductBasket[] - список товаров корзины
- events: IEvents - экземпляр класса `EventEmitter` для инициализации событий при изменении данных

Также класс предоставляет набор методов для взаимодействия с этими данными:

- сеттеры и геттеры для сохранения и получения данных из полей класса
- isProductIn(productId: string): boolean - метод, проверяющий наличие товара в корзине по его Id
- getTotalSum(): number - метод, осуществляющий подсчет общей суммы товаров в корзине
- getItemsCount(): number - метод, осуществляющий подсчет количества товаров в корзине
- isBasketEmpty(): boolean - метод, проверяющий наличие товаров в корзине
- addProduct(product: TProductBasket): void - добавляется продукт в корзину (в конец массива _productsBasket)
- deleteProduct(productId: string):void - удаляется товар из массива по указанному в аргументе id
- clearBasket():void - очищает содержимое корзины (массива _productsBasket)

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных

#### Класс Component
Абстрактный базовый класс для создания UI-компонентов (таких как модальные окна).

- protected constructor(protected readonly container: HTMLElement). Конструктор принимает корневой DOM-элемент в который рендерится компонент. Код в конструкторе выполняется до инициализации дочернего класса.

#### Класс Page
Реализует главную страницу с товарами. Наследуется логика от класса `Component`.
- constructor(container: HTMLElement, protected events: IEvents). Конструктор принимает корневой DOM-элемент модального окна для его инициализации и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса:
- _counter: HTMLElement - счетчик элементов в корзине
- _catalog: HTMLElement - контейнер каталога товаров
- _wrapper: HTMLElement - основная обертка страницы
- _basket: HTMLElement - иконка корзины

Методы класса:
- сеттеры для изменения полей класса
- сеттер для блокировки страницы при взаимодействии с модальным окном

#### Класс Card
Класс для отображения карточки. Наследуется логика от класса `Component`.

- constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions) - Конструктор принимает название корневого DOM-элемента карточки и контейнер с ее наполнением для ее инициализации, а также коллбэк для обработки клика по ней.

Поля класса:
- _title: HTMLElement - название карточки
- _cathegory: HTMLElement - категория карточки
- _image?: HTMLImageElement - изображение карточки
- _description?: HTMLElement - описание карточки
- _button?: HTMLButtonElement - кнопка покупки товара с карточки
Методы класса:
- сеттеры и геттеры для изменения полей карточки

#### Класс FormView
Класс для создания форм. Наследуется логика от класса `Component`.

- constructor(protected container: HTMLFormElement, protected events: IEvents). Конструктор принимает корневой DOM-элемент формы для его инициализации и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса:
- _submit: HTMLButtonElement - кнопка сабмита в форме
- _errors: HTMLElement - поле ошибок в форме

Методы класса:
- сеттеры (`valid`, `errors`) для инициализации ошибок
- render(state: Partial`<T>` & IFormState) - рендер формы на странице


#### Класс Modal
Реализует универсальное модальное окно. Наследуется логика от класса `Component`. Также предоставляет методы `open`, `close` и `render` для управления отображением модального окна. Устанавливает слушатели, на клавиатуру для закрытия модального окна по Esc, на клик в оверлэй и кнопку-крестик для закрытия попапа.

- constructor(container: HTMLElement, protected events: IEvents). Конструктор принимает корневой DOM-элемент модального окна для его инициализации и экземпляр класса `EventEmitter` для возможности инициализации событий.

Поля класса:
- _content: HTMLElement - наполнение модального окна
- events: IEvents - брокер событий

#### Класс SuccessModal
Реализует модальное окно после успешной покупки. Наследуется логика от класса `Component`

- constructor(container: HTMLElement, actions: ISuccessActions). Конструктор принимает корневой DOM-элемент модального окна для его инициализации и экземпляр класса `ISuccessActions` для обработки коллбэка

Поля класса:
- _close: HTMLElement - кнопка перехода на главную страницу

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаиподействие представления и данных между собой находится в файле `index.ts`, выполняющим роль презентера.\
Взаимодействие осуществляется за счет событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделей данных):*
- `productsList: changed` - инициализация и отрисовка списка товаров на главной странице

*События, возникающие при взаимодействии пользователя с интерфейсом: (генерируются классами, отвечающими за представление)*

- `product: select` - при клике на карточку товара, вызывается модальное окно с полным описанием товара
- `product: toBasket` - при добавлении в корзину по клику на кнопке "В корзину" в модальном окне с полным описанием товара
- `basket: open` - при клике на иконку корзины открывается модальное окно с товарами в корзине
- `basket: order` - при клике на кнопку "Оформить" в модальном окне корзины открывается модальное окно для заполнения адреса и способа оплаты
- `basket: delete` - при клике на кнопку удаления товара в модальном окне корзины. При действии товар удаляется из массива productBasket, обновлчется счетчик корзины на главной странице
- `order: submit` - при клике на кнопку "Далее" в модальном окне заполнения адреса и способа оплаты
- `contacts:submit` - при клике на кнопку "Оплатить" в модальном окне заполнения контактов
- `order: success` - при успешном ответе сервера после оплаты товара, открывается модальное окно об успешной оплате
- `modal: close` - при клике вызывающем закрытие окна об успешной оплате